---
title: "DS_NOTES_EDA"
output: github_document
---

```{r, message=FALSE}
library(tidyverse)
library(dplyr)
library(ggridges)
library(patchwork)

```

```{r}
  weather_df = read.csv("C:/Users/Twilight/Desktop/Columbia/Fall Semester 2024/Data Science I/Datasets/weather_data.csv")
  weather_df <- weather_df %>% mutate(month = format(as.Date(date), "%m")) # creates a new column month extracted from date column
```

### Exploratory Data Analysis

* Exploratory Data Analysis is a loosely-defined process. Roughly, the stuff between loading data and formal analysis is exploratory.
* Grouping
  * Datasets often consists of groups(by design/implied/nested)
* Quantitative comparisons across groups are informative
  * Measures of Centrality, Variablity, Missingnes
* `group_by()` + `summarize()`
  * `group_by` makes grouping explicit and adds a layer to your data
  * `summarize()` allows you to compute one-number summaries
    * most useful in conjunction with `group_by()`


#### `group_by()`
```{r}
  weather_df %>%
    group_by(name, month)
```

### counting things
```{r}
  weather_df %>%
    group_by(month) %>%
    summarize(n_obs=n())

  weather_df %>%
    group_by(name, month) %>%
    summarize(count=n())
  
  # Using "count"
  weather_df %>%
    count(name, month, name="n_obs")
  
  weather_df %>%
    group_by(month) %>%
    summarize(
      n_obs = n(),
      n_days= n_distinct(date)
    )
  
```

### General Summaries
```{r}
  weather_df %>%
    group_by(month) %>%
    summarize(
      mean_tmax = mean(tmax, na.rm=TRUE),
      mean_prcp = mean(prcp, na.rm=TRUE),
      median_tmin=median(tmin, na.rm=TRUE)
    )
```

```{r}
  weather_df %>%
    group_by(name, month) %>%
      summarize(across(prcp:tmin, mean))
```

```{r}
  weather_df %>%
    group_by(name, month) %>%
    summarize(mean_tmax=mean(tmax)) %>%
    pivot_wider(
        names_from = name,
        values_from= mean_tmax
    ) %>%
    knitr::kable(digits=1)
```

## `group_by()` and `mutate()`
```{r}
  weather_df %>%
      group_by(name) %>%
      mutate(
          mean_tmax = mean(tmax, na.rm=TRUE),
          centered_tmax = tmax - mean_tmax
      ) %>%
          ggplot(aes(x=date,y=centered_tmax, color=name))+
          geom_point()
```

## What about window functions?
```{r}

  weather_df %>%
      group_by(name, month) %>%
      mutate(temp_rank = min_rank(desc(tmax)))

```

lag
```{r}
  weather_df %>%
      group_by(name) %>%
      mutate(lag_temp = lag(tmax)) # by default, lag_temp contains the record obtained from tmax lagging by 1 position

  weather_df %>%
      group_by(name) %>%
      mutate(lag_temp = lag(tmax, 5))  # you can specify to lag by N positions
  
  weather_df %>%
      group_by(name) %>%
      mutate(temp_change = tmax - lag(tmax)) # 比如，第二行 5.0-8.9=-3.9
  
   weather_df %>%
        group_by(name) %>%
        mutate(temp_change = tmax - lag(tmax)) %>%
        summarize(
            temp_change_max = max(temp_change, na.rm=TRUE),
            temp_change_sd  = sd(temp_change, na.rm=TRUE)
        )
  
  
```







